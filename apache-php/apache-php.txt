The Crypto++ virtual machine is a CentOS 7 VM provided by GoDaddy.
The webserver uses a LAMP stack with Apache, PHP and MySQL. The
webserver also uses Mediawiki software.

Apache, PHP and Mediawiki supplied by Red Hat are too old to be useful
nowadays. To get something newer we enable Software Collections (SCL).
SCL supplies an updated Apache, Python and PHP. Mediawiki is not supplied.
Also see https://wiki.centos.org/AdditionalResources/Repositories/SCL
on the CentOS wiki.

The following instructions install Apache and PHP from Red Hat's SCL.
After installing Apache and PHP we need to install Mediawiki from
sources using a Long Term Release version of the software.

Perform the following to setup the Virtual Machine using SCL:

  yum install centos-release-scl scl-utils-build
  yum update

After SCL is enabled, remove old Apache and PHP, if present:

  yum remove httpd php

And then install newer Apache and PHP:

  yum install httpd24-httpd httpd24-mod_ssl httpd24-mod_security httpd24-httpd-tools
  yum install rh-php72 rh-php72-php rh-php72-php-cli rh-php72-php-common rh-php72-php-gd rh-php72-php-json rh-php72-php-mbstring rh-php72-php-mysqlnd rh-php72-php-pdo rh-php72-php-pear rh-php72-php-process rh-php72-php-xml rh-php72-php-zip rh-php72-runtime

Once installed the new gear is located in /opt/rh. However, some of the configuration files are located in /etc.

  $ ls /opt/rh/
  httpd24  rh-php72

To use the new gear create a couple of scripts in the /etc/profile.d/ directory:

  # cat /etc/profile.d/enable-scl-httpd24.sh 
  #!/usr/bin/env bash
  source scl_source enable httpd24

And:

  # cat /etc/profile.d/enable-scl-php72.sh 
  #!/usr/bin/env bash
  source scl_source enable rh-php72

Crypto++ uses a hardened PHP configuration. Copy security.ini to /etc/opt/rh/rh-php72/php.d/:

  /etc/opt/rh/rh-php72/php.d/security.ini

Open /etc/opt/rh/rh-php72/php.ini, and add the following:

  # tail -n 5 /etc/opt/rh/rh-php72/php.ini
  ;; Security hardening in security.ini
  log_errors = On
  log_errors_max_len = 1024
  error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT
  error_log = /var/log/httpd24/error_log

Reboot the machine. Then, check the programs are on-path as expected:

  # command -v apachectl
  /opt/rh/httpd24/root/usr/sbin/apachectl
  # command -v php
  /opt/rh/rh-php72/root/usr/bin/php

And verify Apache is running:

# systemctl status httpd24-httpd
‚óè httpd24-httpd.service - The Apache HTTP Server
   Loaded: loaded (/usr/lib/systemd/system/httpd24-httpd.service; enabled; vendor preset: disabled)
   Active: active (running) since Mon 2020-04-20 22:15:15 EDT; 44min ago
   ...

Finally, install Mediawiki software. Mediawiki installation is covered in wiki-upgrade.txt.
